pipeline {
    environment{
      dockerimagename = "nidhalmesselmani/my_docker_repo"
      dockerimage = ""
    }
    agent { 
        node {
            label 'docker-agent-cpp'
            }
      }
      stages {
        stage('Build Image') {
            steps {
                echo 'Building the image'
                script {
                  dir("my_cpp_app/source") {
                    dockerimage = docker.build dockerimagename
                  }
                }
               /* sh '''
                cd my_cpp_app/source
                docker build -t nidhamesselmani/my_docker_repo:cpp_to_k8s .
                '''*/
            }
        }
        stage('Push the Image to dockerhub'){
          environment {
            registryCrendential = 'dockerhublogin'
          }
          steps{
            echo 'Push the image to dockerhub'
            script{
              docker.withRegistry('https://hub.docker.com/', registryCrendential){
              dockerimage.push('cpp_to_k8s')

              }

            }
            /*sh '''
              docker push nidhamesselmani/my_docker_repo:cpp_to_k8s
            '''*/
          }
        }
      }
       /*** workspace clean up*/
  post {
    always {
      cleanWs()
    }
  }  
}