pipeline {
    agent { 
        node {
            label 'docker-agent-cpp'
            }
      }
      stages {
        stage('Build Image') {
            steps {
                echo 'Building the image'
                sh '''
                cd my_cpp_app/source
                docker build -t applictation_cpp_to_deploy_to_k8s .
                '''
            }
        }
        stage('Run the Image'){
          steps{
            echo 'RUNNING the container'
            sh '''
            docker run --name cpp_k8s --rm applictation_cpp_to_deploy_to_k8s > runlog.txt
            cat runlog.txt
            '''
          }
        }
      }
       /*** workspace clean up*/
  post {
    always {
      cleanWs()
    }
  }  
}